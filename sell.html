<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sell Item</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js"></script>
  <script src="firebase.js"></script>
</head>
<body>
  <h1>Sell Your Item</h1>
  <form id="sellForm">
    <input type="text" id="title" placeholder="Item Title" required><br><br>
    <textarea id="description" placeholder="Item Description" required></textarea><br><br>
    <input type="number" id="price" placeholder="Price (USD)" required><br><br>
    <select id="category" required>
      <option value="">Select Category</option>
      <option value="clothing">Clothing</option>
      <option value="electronics">Electronics</option>
      <option value="collectibles">Collectibles</option>
      <option value="handmade">Handmade</option>
      <option value="books">Books</option>
      <option value="sports">Sports</option>
      <option value="home">Home & Garden</option>
      <option value="toys">Toys</option>
      <option value="vehicles">Vehicles</option>
    </select><br><br>
    <input type="file" id="image" accept="image/*"><br><br>
    <button type="submit">List Item</button>
  </form>  <script>
    const sellForm = document.getElementById('sellForm');

    sellForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const price = parseFloat(document.getElementById('price').value);
      const category = document.getElementById('category').value;
      const image = document.getElementById('image').files[0];

      try {
        const user = firebase.auth().currentUser;
        if (!user) {
          alert("You must be logged in to list an item.");
          return;
        }

        let imageUrl = "";
        if (image) {
          const storageRef = firebase.storage().ref();
          const imageRef = storageRef.child(`images/${Date.now()}_${image.name}`);
          await imageRef.put(image);
          imageUrl = await imageRef.getDownloadURL();
        }

        await firebase.firestore().collection("products").add({
          title,
          description,
          price,
          category,
          imageUrl,
          userId: user.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        });

        alert("Item listed successfully!");
        sellForm.reset();
      } catch (error) {
        console.error("Listing failed:", error);
        alert("Listing failed. Try again.");
      }
    });
  </script></body>
</html>

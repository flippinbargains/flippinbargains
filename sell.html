<!DOCTYPE html><html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sell Item</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="/firebase.js"></script>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 rounded-2xl shadow-md w-full max-w-md">
      <h1 class="text-2xl font-bold mb-4 text-center">Sell Your Item</h1>
      <form id="sellForm" class="space-y-4">
        <input type="text" id="title" placeholder="Item Title" class="w-full border rounded px-3 py-2" required />
        <textarea id="description" placeholder="Item Description" class="w-full border rounded px-3 py-2" required></textarea>
        <input type="number" id="price" placeholder="Price (USD)" step="0.01" class="w-full border rounded px-3 py-2" required /><select id="category" class="w-full border rounded px-3 py-2">
      <option disabled selected>Select Category</option>
      <option>Electronics</option>
      <option>Clothing</option>
      <option>Collectibles</option>
      <option>Handmade</option>
    </select>

    <select id="shipping" class="w-full border rounded px-3 py-2">
      <option disabled selected>Select Shipping Method</option>
      <option>USPS</option>
      <option>UPS</option>
      <option>FedEx</option>
    </select>

    <input type="number" id="weight" placeholder="Weight (lbs)" step="0.1" class="w-full border rounded px-3 py-2" required />
    <input type="file" id="images" multiple class="w-full" accept="image/*" required />

    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded font-semibold">List Item</button>
    <div id="loading" class="text-center text-sm text-gray-500 hidden">Uploading...</div>
  </form>
</div>

<script>
  const form = document.getElementById('sellForm');
  const loading = document.getElementById('loading');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    loading.classList.remove('hidden');

    const title = document.getElementById('title').value.trim();
    const description = document.getElementById('description').value.trim();
    const price = parseFloat(document.getElementById('price').value);
    const category = document.getElementById('category').value;
    const shipping = document.getElementById('shipping').value;
    const weight = parseFloat(document.getElementById('weight').value);
    const imageFiles = document.getElementById('images').files;

    const imageUrls = [];

    try {
      const storageRef = firebase.storage().ref();
      for (let i = 0; i < imageFiles.length; i++) {
        const file = imageFiles[i];
        const fileRef = storageRef.child(`items/${Date.now()}-${file.name}`);
        await fileRef.put(file);
        const url = await fileRef.getDownloadURL();
        imageUrls.push(url);
      }

      await firebase.firestore().collection('items').add({
        title,
        description,
        price,
        category,
        shipping,
        weight,
        images: imageUrls,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert('Item listed successfully!');
      window.location.href = 'dashboard.html';
    } catch (err) {
      console.error('Upload error:', err);
      alert('Failed to list item. See console for details.');
    } finally {
      loading.classList.add('hidden');
    }
  });
</script>

  </body>
</html>
